schemaType: Workflow
schemaVersion: 1.0.0-alpha.1
maxParallel: 1
stages:
  - jobs:
      root:
        action: install
        installation:
          name: myenv
          namespace: dev
          bundle:
            repository: localhost:5000/myenv
            version: 0.1.0
          credentialSets:
            - myenv
          parameterSets:
            - myenv
        depends:
          - root/app
          - root/infra
      root/app:
        action: install
        installation:
          name: myenv/app
          namespace: dev
          bundle:
            repository: localhost:5000/myapp
            version: 1.2.3
            tag: v1.2.3
          credentials:
            - name: db-connstr
              source:
                porter: workflow.jobs.root.outputs.mysql-connstr
        depends:
          - root/infra
      root/infra:
        action: install
        installation:
          name: myenv/infra
          namespace: dev
          bundle:
            repository: localhost:5000/myinfra
            version: 0.1.0
            tag: v0.1.0
          credentials:
            - name: token
              source:
                porter: workflow.jobs.root.credentials.token
        depends:
          - root/infra/db
      root/infra/db:
        action: install
        installation:
          name: myenv/infra/db
          namespace: dev
          bundle:
            repository: localhost:5000/mysqldb
            version: 0.1.0
            tag: v0.1.0
          credentials:
            - name: token
              source:
                porter: workflow.jobs.root/infra.credentials.token

